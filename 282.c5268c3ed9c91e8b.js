"use strict";(self.webpackChunkcustom_thematic_review=self.webpackChunkcustom_thematic_review||[]).push([[282],{3282:(x,M,r)=>{r.r(M),r.d(M,{ScadminModule:()=>F});var _=r(9808),d=r(3075),p=r(7822),h=r(9451),Z=r(1690),e=r(1223),S=r(2313),A=r(7556),L=r(7668),b=r(5826),T=r(7562);const v=["form"];function y(s,o){1&s&&(e.TgZ(0,"font",22),e._uU(1,"*"),e.qZA())}function m(s,o){if(1&s&&(e.TgZ(0,"div",23),e._uU(1),e.qZA()),2&s){const n=e.oxw(),t=e.MAs(13);e.ekj("d-block",t.errors&&t.errors.required),e.xp6(1),e.hij("",n.formsSchema.landscape.name.error," ")}}function E(s,o){1&s&&(e.TgZ(0,"font",22),e._uU(1,"*"),e.qZA())}function a(s,o){if(1&s&&(e.TgZ(0,"div",23),e._uU(1),e.qZA()),2&s){const n=e.oxw(),t=e.MAs(20);e.ekj("d-block",t.errors&&t.errors.required),e.xp6(1),e.hij("",n.formsSchema.landscape.content.error," ")}}function i(s,o){1&s&&(e.TgZ(0,"font",22),e._uU(1,"*"),e.qZA())}function c(s,o){if(1&s&&(e.TgZ(0,"div",23),e._uU(1),e.qZA()),2&s){const n=e.oxw(),t=e.MAs(27);e.ekj("d-block",t.errors&&(t.errors.required||t.errors.pattern)),e.xp6(1),e.hij("",n.formsSchema.landscape.image.error," ")}}let C,O=(()=>{class s{constructor(n,t,l,u,f,g,R){this.titleServer=n,this.route=t,this.router=l,this.authService=u,this.landscapeService=f,this.swalDefaultService=g,this.spinner=R,this.formsSchema=Z.L,this.data={name:"",content:"",image:""},this.isValueChange=!1,this.isSending=!1,C=this.swalDefaultService.toastDefault}ngOnInit(){this.route.params.subscribe(({id:n})=>{this.id=n,this.title=(this.id?"\u7de8\u8f2f":"\u65b0\u589e")+"\u666f\u9ede",this.id?this.landscapeService.getLandscape(+this.id).subscribe(t=>{t&&(this.data.name=t.name,this.data.content=t.content,this.data.image=t.image,this.initData=Object.assign({},this.data),this.setTitle(),this.spinner.hide())}):(this.setTitle(),this.spinner.hide()),setTimeout(()=>{this.form.valueChanges&&this.form.valueChanges.subscribe(t=>{this.isValueChange=!1;for(const l in t)if(!this.initData||this.initData&&t[l]!==this.initData[l])return void(this.isValueChange=!0)})},1e3)})}setTitle(){this.titleServer.setTitle(`\u3010\u5f8c\u53f0\u7ba1\u7406\u3011${this.title}${this.data.name?` - ${this.data.name}`:""} | ${h.Y.name}`)}onSubmit(){this.spinner.show(),this.isSending=!0,this.data.update_date=new Date,this.id?this.landscapeService.editLandscape(+this.id,this.data).subscribe(n=>{this.setSwalToast(!!(null==n?void 0:n.id))}):(this.data.userId=this.authService.user.id,this.landscapeService.addLandscape(this.data).subscribe(n=>{this.setSwalToast(!!(null==n?void 0:n.id))}))}resetForm(){this.id?this.data=Object.assign({},this.initData):this.form.resetForm()}setSwalToast(n){this.spinner.hide(),C.fire({icon:n?"success":"error",title:`${this.title}${n?"\u6210\u529f":"\u5931\u6557"}`}).then(t=>{n?this.router.navigate(["/scadmin/landscapes"]):this.isSending=!1})}}return s.\u0275fac=function(n){return new(n||s)(e.Y36(S.Dx),e.Y36(p.gz),e.Y36(p.F0),e.Y36(A.e),e.Y36(L.T),e.Y36(b.K),e.Y36(T.t2))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-edit-landscape"]],viewQuery:function(n,t){if(1&n&&e.Gf(v,5),2&n){let l;e.iGM(l=e.CRH())&&(t.form=l.first)}},decls:34,vars:25,consts:[[1,"row","justify-content-center"],[1,"col-md-8","col-xl-6"],[1,"h3","fw-bold","text-dark"],[3,"ngSubmit"],["form","ngForm"],[1,"card"],[1,"card-body"],[1,"mb-3"],["for","nameInput",1,"form-label"],["class","text-danger",4,"ngIf"],["id","nameInput","name","name",1,"form-control",3,"type","ngModel","required","disabled","ngModelChange"],["name","ngModel"],["class","invalid-feedback text-start",3,"d-block",4,"ngIf"],["for","contentInput",1,"form-label"],["id","contentInput","rows","5","name","content",1,"form-control",3,"ngModel","required","disabled","ngModelChange"],["content","ngModel"],["for","imageInput",1,"form-label"],["id","imageInput","name","image",1,"form-control",3,"type","ngModel","required","pattern","disabled","ngModelChange"],["image","ngModel"],[1,"gap-2","d-flex","justify-content-end","mt-3"],["type","button",1,"btn","btn-outline-secondary",3,"disabled","click"],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"text-danger"],[1,"invalid-feedback","text-start"]],template:function(n,t){if(1&n&&(e.TgZ(0,"div",0)(1,"div",1)(2,"h1",2),e._uU(3),e.qZA(),e.TgZ(4,"form",3,4),e.NdJ("ngSubmit",function(){return t.onSubmit()}),e.TgZ(6,"div",5)(7,"div",6)(8,"div",7)(9,"label",8),e._uU(10),e.YNc(11,y,2,0,"font",9),e.qZA(),e.TgZ(12,"input",10,11),e.NdJ("ngModelChange",function(u){return t.data.name=u}),e.qZA(),e.YNc(14,m,2,3,"div",12),e.qZA(),e.TgZ(15,"div",7)(16,"label",13),e._uU(17),e.YNc(18,E,2,0,"font",9),e.qZA(),e.TgZ(19,"textarea",14,15),e.NdJ("ngModelChange",function(u){return t.data.content=u}),e.qZA(),e.YNc(21,a,2,3,"div",12),e.qZA(),e.TgZ(22,"div",7)(23,"label",16),e._uU(24),e.YNc(25,i,2,0,"font",9),e.qZA(),e.TgZ(26,"input",17,18),e.NdJ("ngModelChange",function(u){return t.data.image=u}),e.qZA(),e.YNc(28,c,2,3,"div",12),e.qZA()()(),e.TgZ(29,"div",19)(30,"button",20),e.NdJ("click",function(){return t.resetForm()}),e._uU(31,"\u91cd\u8a2d"),e.qZA(),e.TgZ(32,"button",21),e._uU(33),e.qZA()()()()()),2&n){const l=e.MAs(5),u=e.MAs(13),f=e.MAs(20),g=e.MAs(27);e.xp6(3),e.Oqu(t.title),e.xp6(7),e.Oqu(t.formsSchema.landscape.name.name),e.xp6(1),e.Q6J("ngIf",t.formsSchema.landscape.name.validates.isRequired),e.xp6(1),e.Q6J("type",t.formsSchema.landscape.name.type)("ngModel",t.data.name)("required",t.formsSchema.landscape.name.validates.isRequired)("disabled",t.isSending),e.xp6(2),e.Q6J("ngIf",u.invalid&&(u.dirty||u.touched)),e.xp6(3),e.Oqu(t.formsSchema.landscape.content.name),e.xp6(1),e.Q6J("ngIf",t.formsSchema.landscape.content.validates.isRequired),e.xp6(1),e.Q6J("ngModel",t.data.content)("required",t.formsSchema.landscape.content.validates.isRequired)("disabled",t.isSending),e.xp6(2),e.Q6J("ngIf",f.invalid&&(f.dirty||f.touched)),e.xp6(3),e.Oqu(t.formsSchema.landscape.image.name),e.xp6(1),e.Q6J("ngIf",t.formsSchema.landscape.image.validates.isRequired),e.xp6(1),e.Q6J("type",t.formsSchema.landscape.image.type)("ngModel",t.data.image)("required",t.formsSchema.landscape.image.validates.isRequired)("pattern",t.formsSchema.landscape.image.validates.pattern)("disabled",t.isSending),e.xp6(2),e.Q6J("ngIf",g.invalid&&(g.dirty||g.touched)),e.xp6(2),e.Q6J("disabled",t.isSending),e.xp6(2),e.Q6J("disabled",l.invalid||!t.isValueChange||t.isSending),e.xp6(1),e.hij("\u7acb\u5373",t.title.replace("\u666f\u9ede",""),"")}},directives:[d._Y,d.JL,d.F,_.O5,d.Fj,d.JJ,d.On,d.Q7,d.c5],styles:[""]}),s})();const U=function(s){return["edit",s]};function D(s,o){if(1&s){const n=e.EpF();e.TgZ(0,"tr")(1,"th",11),e._uU(2),e.qZA(),e.TgZ(3,"td")(4,"div",12)(5,"div",13),e._UZ(6,"img",14),e.qZA(),e.TgZ(7,"h2",15)(8,"strong"),e._uU(9),e.qZA()()()(),e.TgZ(10,"td"),e._uU(11),e.qZA(),e.TgZ(12,"td",16)(13,"small"),e._uU(14),e.ALo(15,"date"),e.qZA()(),e.TgZ(16,"td",16)(17,"div",17)(18,"a",18),e.NdJ("click",function(l){const f=e.CHM(n).$implicit,g=e.oxw();return l.preventDefault(),g.delLandscape(f.id)}),e._uU(19,"\u522a\u9664"),e.qZA(),e.TgZ(20,"a",19),e._uU(21,"\u7de8\u8f2f"),e.qZA()()()()}if(2&s){const n=o.$implicit,t=o.index;e.xp6(2),e.Oqu(t+1),e.xp6(4),e.Q6J("src",n.image,e.LSH)("alt",n.name),e.xp6(3),e.Oqu(n.name),e.xp6(2),e.Oqu(n.content),e.xp6(3),e.Oqu(e.xi3(15,7,n.update_date,"yyyy/MM/dd HH:mm:ss")),e.xp6(6),e.Q6J("routerLink",e.VKq(10,U,n.id))}}const I=function(){return["edit"]},q=[{path:"",component:(()=>{class s{constructor(){}ngOnInit(){}}return s.\u0275fac=function(n){return new(n||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-scadmin"]],decls:1,vars:0,template:function(n,t){1&n&&e._UZ(0,"router-outlet")},directives:[p.lC],styles:[""]}),s})(),children:[{path:"landscapes",component:(()=>{class s{constructor(n,t,l){this.titleServer=n,this.landscapeService=t,this.spinner=l,this.title="\u666f\u9ede\u5217\u8868"}ngOnInit(){this.titleServer.setTitle(`\u3010\u5f8c\u53f0\u7ba1\u7406\u3011${this.title} | ${h.Y.name}`),this.getLandscapes()}getLandscapes(){this.spinner.show(),this.landscapeService.getLandscapes().subscribe(n=>{this.landscapes=n,this.spinner.hide()})}delLandscape(n){this.spinner.show(),this.landscapeService.delLandscape(n).subscribe(t=>{t&&this.getLandscapes()})}}return s.\u0275fac=function(n){return new(n||s)(e.Y36(S.Dx),e.Y36(L.T),e.Y36(T.t2))},s.\u0275cmp=e.Xpm({type:s,selectors:[["app-landscape-list"]],decls:22,vars:5,consts:[[1,"h3","fw-bold","text-dark","d-flex","align-items-center"],["href","#","role","button",1,"btn","btn-primary","ms-auto",3,"routerLink"],[1,"table-responsive"],[1,"table","table-striped","table-hover","align-middle"],[1,"text-secondary"],["scope","col",1,"py-2"],["scope","col","width","25%",1,"py-2"],["scope","col",1,"py-2","text-center"],["scope","col","width","13%",1,"py-2"],[4,"ngFor","ngForOf"],[1,"text-end"],["scope","row"],[1,"d-flex","align-items-center"],[1,"img-box","me-3"],[3,"src","alt"],[1,"mb-0","h6"],[1,"text-center"],[1,"d-flex","justify-content-center"],["href","#",1,"text-danger","text-decoration-none",3,"click"],["href","#",1,"text-primary","text-decoration-none","ms-3",3,"routerLink"]],template:function(n,t){1&n&&(e.TgZ(0,"h1",0),e._uU(1),e.TgZ(2,"a",1),e._uU(3,"\u65b0\u589e\u666f\u9ede"),e.qZA()(),e.TgZ(4,"div",2)(5,"table",3)(6,"thead")(7,"tr",4)(8,"th",5),e._uU(9,"#"),e.qZA(),e.TgZ(10,"th",6),e._uU(11,"\u540d\u7a31"),e.qZA(),e.TgZ(12,"th",5),e._uU(13,"\u63cf\u8ff0"),e.qZA(),e.TgZ(14,"th",7),e._uU(15,"\u66f4\u65b0\u6642\u9593"),e.qZA(),e._UZ(16,"th",8),e.qZA()(),e.TgZ(17,"tbody"),e.YNc(18,D,22,12,"tr",9),e.qZA(),e.TgZ(19,"caption",10)(20,"small"),e._uU(21),e.qZA()()()()),2&n&&(e.xp6(1),e.Oqu(t.title),e.xp6(1),e.Q6J("routerLink",e.DdM(4,I)),e.xp6(16),e.Q6J("ngForOf",t.landscapes),e.xp6(3),e.hij("\u7e3d\u5171 ",null==t.landscapes?null:t.landscapes.length," \u7b46"))},directives:[p.yS,_.sg],pipes:[_.uU],styles:[".img-box[_ngcontent-%COMP%]{width:120px;height:80px}"]}),s})()},{path:"landscapes/edit",component:O},{path:"landscapes/edit/:id",component:O},{path:"**",redirectTo:"/scadmin/landscapes",pathMatch:"full"}]}];let P=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[p.Bz.forChild(q)],p.Bz]}),s})(),F=(()=>{class s{}return s.\u0275fac=function(n){return new(n||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[_.ez,P,d.u5]]}),s})()},7668:(x,M,r)=>{r.d(M,{T:()=>y});var _=r(1135),d=r(4004),p=r(262),h=r(9646),Z=r(5136),e=r(1223),S=r(520),A=r(7556),L=r(5826),b=r(7562);let T,v,y=(()=>{class m extends Z.b{constructor(a,i,c,C){super(C),this.http=a,this.authService=i,this.swalDefaultService=c,this.spinner=C,this.myCollects$=new _.X(!1),T=this.swalDefaultService.popupDefault,v=this.swalDefaultService.toastDefault}getLandscapes(){return this.http.get(`${this.API_ROOT}/444/landscapes`).pipe((0,d.U)(a=>a.sort((i,c)=>i.update_date>c.update_date?-1:1)),(0,p.K)(a=>(this.errorMsg(a),(0,h.of)(this.errorMsg(a)))))}getLandscape(a){return this.http.get(`${this.API_ROOT}/444/landscapes/${a}`).pipe((0,d.U)(i=>i),(0,p.K)(i=>(this.errorMsg(i),(0,h.of)(this.errorMsg(i)))))}addLandscape(a){return this.http.post(`${this.API_ROOT}/660/landscapes`,a,this.getHeader()).pipe((0,d.U)(i=>i),(0,p.K)(i=>(console.error(i),(0,h.of)(this.errorMsg(i)))))}editLandscape(a,i){return this.http.patch(`${this.API_ROOT}/600/landscapes/${a}`,i,this.getHeader()).pipe((0,d.U)(c=>c),(0,p.K)(c=>(this.errorMsg(c),(0,h.of)(this.errorMsg(c)))))}delLandscape(a){return this.http.delete(`${this.API_ROOT}/600/landscapes/${a}`,this.getHeader()).pipe((0,d.U)(i=>(v.fire({icon:"error",title:"\u522a\u9664\u6210\u529f"}),!0)),(0,p.K)(i=>{this.spinner.hide(),this.errorMsg(i);let c=i.error;return c.match("Private resource access: entity must have a reference to the owner id")&&(c="\u60a8\u4e0d\u662f\u8a72\u7b46\u8cc7\u6599\u7684\u64c1\u6709\u8005"),T.fire({icon:"error",title:"\u522a\u9664\u5931\u6557",text:c,showConfirmButton:!1}),(0,h.of)(this.errorMsg(i))}))}addCollect(a){const i={landscapeId:a,userId:this.authService.user.id,create_date:new Date};return this.http.post(`${this.API_ROOT}/660/collects`,i,this.getHeader()).pipe((0,d.U)(c=>(v.fire({icon:"success",title:"\u52a0\u5165\u6536\u85cf\u6210\u529f"}),this.myCollects().subscribe(),c)),(0,p.K)(c=>(0,h.of)(this.errorMsg(c))))}delCollect(a){return this.http.delete(`${this.API_ROOT}/600/collects/${a}`,this.getHeader()).pipe((0,d.U)(i=>(v.fire({icon:"success",title:"\u79fb\u9664\u6536\u85cf\u6210\u529f"}),this.myCollects().subscribe(),i)),(0,p.K)(i=>(0,h.of)(this.errorMsg(i))))}myCollects(){return this.http.get(`${this.API_ROOT}/400/users/${this.authService.user.id}/collects`,this.getHeader()).pipe((0,d.U)(a=>(this.myCollects$.next(a),a)),(0,p.K)(a=>(this.errorMsg(a),this.myCollects$.next(!1),(0,h.of)(this.errorMsg(a)))))}}return m.\u0275fac=function(a){return new(a||m)(e.LFG(S.eN),e.LFG(A.e),e.LFG(L.K),e.LFG(b.t2))},m.\u0275prov=e.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})()}}]);